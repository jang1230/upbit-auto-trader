# 🔄 실거래 모드 전환 가이드

Upbit DCA Trader에서 페이퍼 트레이딩 ↔ 실거래 모드를 전환하는 방법입니다.

---

## ⚠️ 실거래 전 필수 체크리스트

### 1. Upbit API 키 권한 확인
```
Upbit 홈페이지 → 마이페이지 → Open API 관리
```

**필요한 권한**:
- ✅ 자산 조회
- ✅ 주문 조회
- ✅ **주문하기** ← 이 권한이 있어야 실거래 가능!

### 2. Upbit 계좌 KRW 잔고 확인
```
권장 최소 잔고:
- 반자동 모드: 50,000원 이상
- 완전 자동 모드: 100,000원 이상
```

### 3. DCA 설정 소액으로 조정
```
안전한 소액 테스트:
- DCA 레벨 1: 5,000원 (Upbit 최소 주문 금액)
- DCA 레벨 2: 5,000원
- DCA 레벨 3: 5,000원
→ 최대 손실: 15,000원 × 선택한 코인 수
```

GUI에서 "⚙️ DCA 설정 변경" 버튼으로 조정하세요.

### 4. 완전 자동 모드 설정 (완전 자동 사용 시)
```
소액 테스트 권장 설정:
- 매수 금액: 5,000원
- 모니터링: 상위 3~5개
- 최대 포지션: 2개
- 일일 거래: 3회
- 최소 잔고: 50,000원
- 일일 손실 한도: 5%
```

### 5. Telegram 알림 확인
```
현재 설정:
- 봇 토큰: 8491103895:AAFLxuW38Wjoi7vgzuu5PAib7AuL_rHldTM
- 채팅 ID: 8461158159

테스트 메시지 전송 확인 필수!
```

---

## 🔧 모드 전환 방법

### ⚡ 자동 전파 시스템

**좋은 소식!** 이제 `main_window.py`의 주석만 변경하면 됩니다.

`dry_run` 설정이 자동으로 모든 컴포넌트에 전파됩니다:

```
main_window.py (dry_run: True/False)
    ↓ 자동 전파
AutoTradingWorker
    ↓ 자동 전파
AutoTradingManager
    ↓ 자동 전파
OrderManager.execute_buy()
```

**결과**: 3군데 주석을 변경하면 반자동/완전자동 모드 모두 자동으로 전환됩니다! 🎉

### 📁 파일 위치
```
D:\claude-project12\upbit_dca_trader\gui\main_window.py
```

### 📝 수정 위치 1: 확인 메시지 (920번째 줄 근처)

#### 현재 상태: ✅ 페이퍼 트레이딩 모드
```python
# ✅ 페이퍼 트레이딩 모드 (테스트용 - 실제 주문 안함)
reply = QMessageBox.question(
    self,
    "트레이딩 시작",
    "⚠️ <b>트레이딩을 시작하시겠습니까?</b><br><br>"
    "페이퍼 트레이딩(Dry Run) 모드로 시작됩니다.<br>"
    "실제 주문은 실행되지 않습니다.<br><br>"
    "<b>실거래 모드로 전환하려면:</b><br>"
    "main_window.py 파일에서 주석을 변경하세요.",
    QMessageBox.Yes | QMessageBox.No,
    QMessageBox.No
)

# # 🚨 실거래 모드 (실제 주문 실행 - 돈 잃을 수 있음!)
# reply = QMessageBox.question(
#     self,
#     "🚨 실거래 모드 시작 확인",
#     "⚠️⚠️⚠️ <b>실제 거래 모드입니다!</b> ⚠️⚠️⚠️<br><br>"
#     "<b style='color: red;'>실제 돈으로 주문이 실행됩니다!</b><br><br>"
#     "확인 사항:<br>"
#     "✅ Upbit API 키에 '주문하기' 권한 있음<br>"
#     "✅ 충분한 KRW 잔고 확인<br>"
#     "✅ DCA 설정 소액으로 조정<br>"
#     "✅ 텔레그램 알림 동작 확인<br><br>"
#     "<b>정말로 시작하시겠습니까?</b>",
#     QMessageBox.Yes | QMessageBox.No,
#     QMessageBox.No
# )
```

#### 실거래로 전환: 🚨 주석 위치 변경
```python
# ✅ 페이퍼 트레이딩 모드 (테스트용 - 실제 주문 안함)
# reply = QMessageBox.question(
#     self,
#     "트레이딩 시작",
#     "⚠️ <b>트레이딩을 시작하시겠습니까?</b><br><br>"
#     "페이퍼 트레이딩(Dry Run) 모드로 시작됩니다.<br>"
#     "실제 주문은 실행되지 않습니다.<br><br>"
#     "<b>실거래 모드로 전환하려면:</b><br>"
#     "main_window.py 파일에서 주석을 변경하세요.",
#     QMessageBox.Yes | QMessageBox.No,
#     QMessageBox.No
# )

# 🚨 실거래 모드 (실제 주문 실행 - 돈 잃을 수 있음!)
reply = QMessageBox.question(
    self,
    "🚨 실거래 모드 시작 확인",
    "⚠️⚠️⚠️ <b>실제 거래 모드입니다!</b> ⚠️⚠️⚠️<br><br>"
    "<b style='color: red;'>실제 돈으로 주문이 실행됩니다!</b><br><br>"
    "확인 사항:<br>"
    "✅ Upbit API 키에 '주문하기' 권한 있음<br>"
    "✅ 충분한 KRW 잔고 확인<br>"
    "✅ DCA 설정 소액으로 조정<br>"
    "✅ 텔레그램 알림 동작 확인<br><br>"
    "<b>정말로 시작하시겠습니까?</b>",
    QMessageBox.Yes | QMessageBox.No,
    QMessageBox.No
)
```

---

### 📝 수정 위치 2: 시작 로그 (950번째 줄 근처)

#### 현재 상태: ✅ 페이퍼 트레이딩
```python
# ✅ 페이퍼 트레이딩 모드 로그
self._add_log("⚠️ 페이퍼 트레이딩 모드 (Dry Run)")

# # 🚨 실거래 모드 로그
# self._add_log("🚨🚨🚨 실거래 모드 - 실제 주문 실행 🚨🚨🚨")
# self._add_log("💰 실제 돈으로 거래가 진행됩니다!")
```

#### 실거래로 전환: 🚨 주석 위치 변경
```python
# ✅ 페이퍼 트레이딩 모드 로그
# self._add_log("⚠️ 페이퍼 트레이딩 모드 (Dry Run)")

# 🚨 실거래 모드 로그
self._add_log("🚨🚨🚨 실거래 모드 - 실제 주문 실행 🚨🚨🚨")
self._add_log("💰 실제 돈으로 거래가 진행됩니다!")
```

---

### 📝 수정 위치 3: dry_run 플래그 (980번째 줄 근처)

#### 현재 상태: ✅ 페이퍼 트레이딩
```python
# ========================================
# 🔄 모드 전환: 아래 주석을 바꾸면 페이퍼/실거래 전환
# ========================================
'dry_run': True,   # ✅ 페이퍼 트레이딩 모드 (안전)
# 'dry_run': False,  # 🚨 실거래 모드 (실제 주문!)
```

#### 실거래로 전환: 🚨 주석 위치 변경
```python
# ========================================
# 🔄 모드 전환: 아래 주석을 바꾸면 페이퍼/실거래 전환
# ========================================
# 'dry_run': True,   # ✅ 페이퍼 트레이딩 모드 (안전)
'dry_run': False,  # 🚨 실거래 모드 (실제 주문!)
```

---

## 🎯 전환 순서 요약

### 페이퍼 → 실거래 전환
1. ✅ 위 체크리스트 모두 확인
2. ✅ main_window.py 파일 열기
3. ✅ 3개 위치에서 주석(`#`) 위치 변경
   - 위치 1: 확인 메시지 (920번째 줄)
   - 위치 2: 시작 로그 (950번째 줄)
   - 위치 3: dry_run 플래그 (980번째 줄)
4. ✅ 파일 저장 (Ctrl+S)
5. ✅ GUI 재시작 (`python main.py`)
6. ✅ **소액으로 먼저 테스트!**

### 실거래 → 페이퍼 전환 (다시 테스트하고 싶을 때)
1. ✅ 3개 위치에서 주석(`#`) 원래대로 복구
2. ✅ 파일 저장 (Ctrl+S)
3. ✅ GUI 재시작

---

## 📊 실거래 테스트 시나리오

### 반자동 모드 테스트
```
1. DCA 설정: 레벨 3개, 각 5,000원
2. 코인 선택: BTC, ETH, XRP (3개)
3. Upbit 앱에서 직접 5,000원 매수
4. GUI에서 DCA 자동 관리 확인
5. 텔레그램 알림 확인
```

### 완전 자동 모드 테스트
```
1. 자동 설정: 매수 5,000원, 상위 3개, 최대 2포지션
2. DCA 설정: 레벨 3개, 각 5,000원
3. GUI 시작
4. 시그널 감지 시 자동 매수 확인
5. DCA 자동 관리 확인
6. 텔레그램 알림 확인
```

---

## ⚠️ 주의사항

1. **처음 실거래는 반드시 소액으로!**
   - 5,000원 × 3개 코인 = 최대 45,000원 손실 가능

2. **텔레그램 알림 필수 확인**
   - 모든 주문이 텔레그램으로 알림 옴
   - 알림 안 오면 설정 재확인

3. **Upbit 수수료 고려**
   - 매수/매도 각 0.05% 수수료
   - 5,000원 주문 시 약 5원 수수료

4. **긴급 중지 방법**
   - GUI에서 "■ 전체 DCA 중지" 버튼
   - 또는 프로그램 강제 종료

5. **문제 발생 시**
   - 즉시 중지 버튼 클릭
   - 텔레그램 알림 확인
   - 로그 파일 확인

---

## 📞 문제 해결

### 주문이 실행되지 않음
```
원인: API 키에 '주문하기' 권한 없음
해결: Upbit에서 API 키 재발급 (주문하기 권한 체크)
```

### 잔고 부족 오류
```
원인: KRW 잔고가 주문 금액보다 적음
해결: Upbit에 KRW 입금
```

### 텔레그램 알림 안 옴
```
원인: 봇 토큰 또는 채팅 ID 오류
해결: .env 파일 설정 확인
```

---

## ✅ 안전하게 실거래 시작하기

1. 이 가이드를 모두 읽었나요?
2. 체크리스트를 모두 확인했나요?
3. 소액(5,000원)으로 시작하나요?
4. 텔레그램 알림이 동작하나요?
5. 긴급 중지 방법을 알고 있나요?

**모두 ✅ 라면 실거래를 시작하세요!**

행운을 빕니다! 🚀
